<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2025-06-29 Sun 22:53 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Creating a Paint Component in Entmorph</title>
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<link href="/css/style.css" rel="stylesheet" type="text/css"></link>
<style>body{font-size: 30px;}code{background:#efefef;padding: 4px;border-radius:5px;}ul{list-style-type:circle;}</style>
</head>
<body>
<div id="content" class="content">
<h1 class="title">Creating a Paint Component in Entmorph</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgf234562">1. Overview</a></li>
<li><a href="#orgbf25510">2. Starting with :styles</a></li>
<li><a href="#org8000df9">3. Add classes</a></li>
<li><a href="#org4e40766">4. Add &lt;canvas&gt;</a></li>
<li><a href="#org3a7e417">5. Build then Preview</a></li>
<li><a href="#org236f21c">6. Add :behaviours</a></li>
<li><a href="#orga718b56">7. Rename <code>state-var</code> -&gt; <code>canvas-styles</code></a></li>
<li><a href="#orge31475f">8. <b>Preview Component</b></a></li>
<li><a href="#org6e25cf6">9. Add line to canvas</a></li>
<li><a href="#org40f2023">10. Set :autostart? true</a></li>
<li><a href="#org061e228">11. <b>Preview Component</b></a></li>
<li><a href="#org2c96a69">12. Add: rect, fill-circle behaviours</a></li>
<li><a href="#orgfa049ac">13. Switch to <code>rectangle</code> on canvas</a></li>
<li><a href="#orgb488305">14. Switch to <code>fill-circle</code> on canvas</a></li>
<li><a href="#org491f35e">15. Two things</a></li>
<li><a href="#org688ebfd">16. Add :switcher</a></li>
<li><a href="#org047e9ae">17. Update switcher :behaviours map</a></li>
<li><a href="#org674579e">18. Add :state &gt; <code>mode-state</code></a></li>
<li><a href="#orge4a0b41">19. Set switcher :mode-state, :init-mode</a></li>
<li><a href="#orge7dd54d">20. Add switcher to canvas</a></li>
<li><a href="#orgba0cbee">21. <b>Preview Component</b></a></li>
<li><a href="#org0126cc2">22. Add canvas mode buttons</a></li>
<li><a href="#org56c3494">23. Add :#each Special Element</a>
<ul>
<li><a href="#orgf351b3e">23.1. Add :fieldset</a></li>
<li><a href="#orge22a64b">23.2. Add :div with :on-click Event Map</a></li>
<li><a href="#orgfd75181">23.3. Add Buttons</a></li>
<li><a href="#org07b15c1">23.4. Update parent :div Event Handler</a></li>
</ul>
</li>
<li><a href="#org3e25558">24. <b>Preview Component</b></a></li>
<li><a href="#org71cba32">25. Set canvas-styles state var</a></li>
<li><a href="#orgce562dc">26. <b>Preview Component</b></a></li>
<li><a href="#orgada8376">27. Add table to update canvas-styles</a></li>
<li><a href="#orgf8b9e5d">28. Destructure canvas-styles state variable</a></li>
<li><a href="#orgc2df9f5">29. Add cursors to :input elements</a></li>
<li><a href="#org76fa7c9">30. <b>Preview Component</b></a></li>
<li><a href="#org57ac611">31. Last steps: Clear Canvas, Download</a></li>
<li><a href="#orgbcb6993">32. Set :html.canvas/clear :canvas-id</a></li>
<li><a href="#org05cf2a2">33. Add Download button</a></li>
<li><a href="#orgda8ee6e">34. <b>Preview Component</b></a></li>
<li><a href="#org89d0bea">35. <span class="todo TODO">TODO</span> :noexport:</a></li>
<li><a href="#orgb0c4f8b">36. Conclusion</a></li>
</ul>
</div>
</div>
<p>
<a href="./index.html">Index</a>
<a id="org563fa73"></a>
</p>

<div id="outline-container-orgf234562" class="outline-2">
<h2 id="orgf234562"><span class="section-number-2">1.</span> Overview</h2>
<div class="outline-text-2" id="text-1">
<p>
<a href="#org563fa73">Top</a>
</p>
<ul class="org-ul">
<li>Hi, I'm Ali Hussein, creator of Entmorph,</li>
<li>and in this video, we're going create a Paint Component,
<ul class="org-ul">
<li>which will look like this when it's finished</li>
</ul></li>
<li><code>Demo component</code>
<ul class="org-ul">
<li>Fill Style</li>
<li>Stroke Style</li>
<li>Download first</li>
<li>then Clear</li>
</ul></li>
<li>You can see it's quite basic, but this is more to show you how you can create a component like this very quickly using a number of features of Entmorph components which we'll explore in this video;</li>
</ul>
</div>
</div>
<div id="outline-container-orgbf25510" class="outline-2">
<h2 id="orgbf25510"><span class="section-number-2">2.</span> Starting with :styles</h2>
<div class="outline-text-2" id="text-2">
<p>
<a href="#org563fa73">Top</a>
</p>
<ul class="org-ul">
<li><code>Switch to 1st Tab</code></li>
<li>To save some time, I've already created a project with a component which has all the styles we're going to use already defined;</li>
<li><code>scroll-to</code> :styles &gt; Outline</li>
<li>There are three class style rules;
<ul class="org-ul">
<li><code>.main</code></li>
<li><code>.control-panel</code></li>
<li><code>.canvas-container</code></li>
</ul></li>
<li>which we'll apply as we go along;</li>
<li><code>scroll-to</code> :styles</li>
<li>I'll collapse the :styles section as we won't need to update it;</li>
</ul>
</div>
</div>
<div id="outline-container-org8000df9" class="outline-2">
<h2 id="org8000df9"><span class="section-number-2">3.</span> Add classes</h2>
<div class="outline-text-2" id="text-3">
<p>
<a href="#org563fa73">Top</a>
</p>
<ul class="org-ul">
<li>I'll set .main on the root <code>div</code> element
<ul class="org-ul">
<li>I'm using the <code>tag.class</code> notation,</li>
</ul></li>
<li>within that I'll Add two <code>div</code> elements:
<ul class="org-ul">
<li><code>div.control-panel</code></li>
<li><code>div.canvas-container</code></li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org4e40766" class="outline-2">
<h2 id="org4e40766"><span class="section-number-2">4.</span> Add &lt;canvas&gt;</h2>
<div class="outline-text-2" id="text-4">
<p>
<a href="#org563fa73">Top</a>
</p>
<ul class="org-ul">
<li>within <code>div.canvas-container</code>
<ul class="org-ul">
<li>I'll add a &lt;canvas&gt; element</li>
<li>which has default attributes for width and height
<ul class="org-ul">
<li>and a message which lets people know if their browser doesn't support canvas elements</li>
</ul></li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org3a7e417" class="outline-2">
<h2 id="org3a7e417"><span class="section-number-2">5.</span> Build then Preview</h2>
<div class="outline-text-2" id="text-5">
<p>
<a href="#org563fa73">Top</a>
</p>
<ul class="org-ul">
<li><code>scroll-to</code> Run Panel</li>
<li>there's a panel on the left which we'll fill with buttons
<ul class="org-ul">
<li>and clicking on the canvas does nothing,</li>
<li>which is to be expected;</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org236f21c" class="outline-2">
<h2 id="org236f21c"><span class="section-number-2">6.</span> Add :behaviours</h2>
<div class="outline-text-2" id="text-6">
<p>
<a href="#org563fa73">Top</a>
</p>
<ul class="org-ul">
<li>Let's add the ability for users to draw lines on the canvas;</li>
<li><b>Goto</b> &gt; <code>Code</code></li>
<li>Open the Component for editing <code>(Edit icon)</code>
<ul class="org-ul">
<li>which makes the <code>Component Commands</code> appear;</li>
</ul></li>
<li><code>click on</code> <b>Add Section &gt; :behaviours</b>
<ul class="org-ul">
<li>to add a <code>:behaviours</code> section</li>
<li>which is where we declare behaviours for our component;</li>
</ul></li>
<li>What is a behaviour? A behaviour is a declarative way to specify, well, some way you want the component to behave;</li>
<li>As you can see from the default empty behaviour which is created for us,
<ul class="org-ul">
<li>a behaviour has an Id, which in this case I'll rename to <code>line</code></li>
<li>and an expression, which is a map which lets us specify a <code>:type</code> of behaviour
<ul class="org-ul">
<li>given it an <code>:arg</code></li>
<li>and it also has an <code>:autostart?</code> key which we'll come back to in a minute;</li>
</ul></li>
</ul></li>
<li>We want our users to be able to draw a line on the Canvas;</li>
<li>So'll click on the <code>:type</code> value,
<ul class="org-ul">
<li>which opens a *Select Behaviour" dropdown menu, which contains a number of behaviour names;</li>
<li>I'll select <code>:html.canvas.mouse/line</code>;</li>
<li>notice that the <code>:arg</code> value is now a map which defines a <code>:canvas-styles</code> entry;
<ul class="org-ul">
<li><code>click on</code> <b>Select State</b></li>
<li>and select <code>state-var</code></li>
</ul></li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-orga718b56" class="outline-2">
<h2 id="orga718b56"><span class="section-number-2">7.</span> Rename <code>state-var</code> -&gt; <code>canvas-styles</code></h2>
<div class="outline-text-2" id="text-7">
<p>
<a href="#org563fa73">Top</a>
</p>
<ul class="org-ul">
<li><b>Goto</b> &gt; <code>:state</code>
<ul class="org-ul">
<li>and rename <code>state-var</code> by clicking on it</li>
<li>and changing its name to <code>canvas-styles</code></li>
<li>and I'll set its initial value to an empty map for now</li>
<li>we'll come back to this a little later and fill it;</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-orge31475f" class="outline-2">
<h2 id="orge31475f"><span class="section-number-2">8.</span> <b>Preview Component</b></h2>
<div class="outline-text-2" id="text-8">
<p>
<a href="#org563fa73">Top</a>
</p>
<ul class="org-ul">
<li>Now when I click on the canvas,
<ul class="org-ul">
<li>nothing happens(!)</li>
</ul></li>
<li>This is to be expected;
<ul class="org-ul">
<li>although we created a line behaviour in the <code>:behaviours</code> section,</li>
<li>we still need to add the behaviour to an element for it to do anything;</li>
</ul></li>
<li>So always remember that you need to add a behaviour to an element;</li>
</ul>
</div>
</div>
<div id="outline-container-org6e25cf6" class="outline-2">
<h2 id="org6e25cf6"><span class="section-number-2">9.</span> Add line to canvas</h2>
<div class="outline-text-2" id="text-9">
<p>
<a href="#org563fa73">Top</a>
</p>
<ul class="org-ul">
<li>So let's do that now</li>
<li>The element we need to add the behaviour to is of course the <code>canvas</code> element;</li>
<li><code>scroll-to</code> canvas element</li>
<li>To add it, we need to use a Special Attribute,
<ul class="org-ul">
<li>which is an Entmorph extension to HTML;</li>
</ul></li>
<li><code>[open</code> <b>Attributes</b> <code>for editing]</code>
<ul class="org-ul">
<li>which opens the Attributes Map editor;</li>
<li><code>click on</code> <b>Add Special</b>
<ul class="org-ul">
<li>which gives us a sub-commands panel containing two special attributes;</li>
<li>all special attributes have a #-prefix;</li>
<li>I'll select <code>#behaviours</code>
<ul class="org-ul">
<li>which lets us connect behaviours to elements;</li>
</ul></li>
</ul></li>
<li>In the "Select Behaviours" editor which has appeared,
<ul class="org-ul">
<li>I'll click on the checkbox for "line",</li>
<li>to add the line behaviour to the canvas;</li>
</ul></li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org40f2023" class="outline-2">
<h2 id="org40f2023"><span class="section-number-2">10.</span> Set :autostart? true</h2>
<div class="outline-text-2" id="text-10">
<p>
<a href="#org563fa73">Top</a>
</p>
<ul class="org-ul">
<li>But there's one more thing we need to do to get our line behaviour to work;</li>
<li><b>Goto</b> &gt; <code>:behaviours</code></li>
<li>and I'll set the <code>:autostart?</code> entry of the line behaviour from false to true;</li>
<li>This ensures that the behaviour starts as soon as it's added to the element;
<ul class="org-ul">
<li>the reason it's set to false by default is that there are other ways to start behaviours, including:
<ul class="org-ul">
<li>using special start and stop behaviour events</li>
<li>and via other behaviours, which we'll look at very soon in this video;</li>
</ul></li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org061e228" class="outline-2">
<h2 id="org061e228"><span class="section-number-2">11.</span> <b>Preview Component</b></h2>
<div class="outline-text-2" id="text-11">
<p>
<a href="#org563fa73">Top</a>
</p>
<ul class="org-ul">
<li>Now let's try drawing on the canvas again
<ul class="org-ul">
<li>As I click and drag the mouse on the canvas, a straight line appears</li>
<li>[TODO: if I move the mouse outside of the canvas, the line continues to move!]</li>
</ul></li>
<li>So with very little code, our users can now draw straight lines on the canvas;</li>
</ul>
</div>
</div>
<div id="outline-container-org2c96a69" class="outline-2">
<h2 id="org2c96a69"><span class="section-number-2">12.</span> Add: rect, fill-circle behaviours</h2>
<div class="outline-text-2" id="text-12">
<p>
<a href="#org563fa73">Top</a>
</p>
<ul class="org-ul">
<li>So let's give our users the ability to draw more things than just straight lines;</li>
<li><b>Goto</b> &gt; <code>:behaviours</code></li>
<li><code>click on</code> <b>Add</b>
<ul class="org-ul">
<li><code>rectangle</code></li>
<li><code>stroke.rect</code></li>
<li>Set: canvas-styles</li>
<li>:autostart? true</li>
</ul></li>
<li><code>click on</code> <b>Add</b>
<ul class="org-ul">
<li><code>fill-circle</code></li>
<li><code>fill.circle</code></li>
<li>Set: canvas-styles</li>
<li>:autostart? true</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-orgfa049ac" class="outline-2">
<h2 id="orgfa049ac"><span class="section-number-2">13.</span> Switch to <code>rectangle</code> on canvas</h2>
<div class="outline-text-2" id="text-13">
<p>
<a href="#org563fa73">Top</a>
</p>
<ul class="org-ul">
<li><code>scroll-to</code> canvas</li>
<li><code>click on</code> <b>:#behaviours</b></li>
<li>We can change from <code>line</code> to <code>rectangle</code></li>
<li><b>Preview Component</b></li>
</ul>
</div>
</div>
<div id="outline-container-orgb488305" class="outline-2">
<h2 id="orgb488305"><span class="section-number-2">14.</span> Switch to <code>fill-circle</code> on canvas</h2>
<div class="outline-text-2" id="text-14">
<p>
<a href="#org563fa73">Top</a>
</p>
<ul class="org-ul">
<li><b>Preview Component</b></li>
<li>So depending on which behaviour we select for them,
<ul class="org-ul">
<li>our users can now draw a line, a rectangle or a cirle;</li>
</ul></li>
<li>But the problem is, our users can't select the shape they can draw;
<ul class="org-ul">
<li>they're stuck with what we set for them when we build the component,
<ul class="org-ul">
<li>which of course is very boring for them;</li>
</ul></li>
</ul></li>
<li>So let's give our users the ability to select a shape;</li>
</ul>
</div>
</div>
<div id="outline-container-org491f35e" class="outline-2">
<h2 id="org491f35e"><span class="section-number-2">15.</span> Two things</h2>
<div class="outline-text-2" id="text-15">
<p>
<a href="#org563fa73">Top</a>
</p>
<ul class="org-ul">
<li>The best way to do this is to add some buttons to let our users select a shape;</li>
<li>There are two things we need to do to make this happen;
<ul class="org-ul">
<li>first we need some way to select which behaviour is active on the canvas at any one time</li>
<li>then, we need to create buttons which will do the actual selecting</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org688ebfd" class="outline-2">
<h2 id="org688ebfd"><span class="section-number-2">16.</span> Add :switcher</h2>
<div class="outline-text-2" id="text-16">
<p>
<a href="#org563fa73">Top</a>
</p>
<ul class="org-ul">
<li>To select which behaviour is active on the canvas,
<ul class="org-ul">
<li>we need to create another behaviour that let's us switch behaviour;;</li>
</ul></li>
<li><code>click on</code> <b>Add</b>
<ul class="org-ul">
<li><code>switcher</code></li>
<li><code>:switch-behaviour</code></li>
</ul></li>
<li>Which does exactly what we're looking for;
<ul class="org-ul">
<li>If we look at its <code>:arg</code> map;
<ul class="org-ul">
<li>it defines the following few keys;</li>
<li><code>:behaviours</code> is a map of all the behaviours we want the switcher to select from;</li>
<li><code>:mode-state</code> has to be set to a state variable which will hold the current mode;</li>
<li><code>:init-mode</code> is the initial mode when the behaviour is first added to the canvas;</li>
</ul></li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org047e9ae" class="outline-2">
<h2 id="org047e9ae"><span class="section-number-2">17.</span> Update switcher :behaviours map</h2>
<div class="outline-text-2" id="text-17">
<p>
<a href="#org563fa73">Top</a>
</p>
<ul class="org-ul">
<li>Let's update the :behaviours map</li>
</ul>
<div class="org-src-container">
<pre class="src src-clojurescript"><span style="color: #707183;">{</span><span style="color: #F5666D;">:line</span>        line
 <span style="color: #F5666D;">:rectangle</span>   rectangle
 <span style="color: #F5666D;">:fill-circle</span> fill-circle<span style="color: #707183;">}</span>
</pre>
</div>
<ul class="org-ul">
<li>The keys need to be keywords, and the values are the behaviours we want our users to switch between;
<ul class="org-ul">
<li>we'll use the keys to refer to the behaviours from <code>mode-state</code> and <code>init-mode</code></li>
</ul></li>
<li>For <code>mode-state</code> we need to create a new state variable;</li>
</ul>
</div>
</div>
<div id="outline-container-org674579e" class="outline-2">
<h2 id="org674579e"><span class="section-number-2">18.</span> Add :state &gt; <code>mode-state</code></h2>
<div class="outline-text-2" id="text-18">
<p>
<a href="#org563fa73">Top</a>
</p>
<ul class="org-ul">
<li><b>Goto</b> &gt; <code>:state</code></li>
<li><code>click on</code> <b>Add</b>
<ul class="org-ul">
<li><code>canvas-mode</code></li>
<li><code>nil</code></li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-orge4a0b41" class="outline-2">
<h2 id="orge4a0b41"><span class="section-number-2">19.</span> Set switcher :mode-state, :init-mode</h2>
<div class="outline-text-2" id="text-19">
<p>
<a href="#org563fa73">Top</a>
</p>
<ul class="org-ul">
<li><b>Goto</b> &gt; <code>:behaviours &gt; switcher</code>
<ul class="org-ul">
<li>Set <code>:mode-state</code> <code>canvas-mode</code></li>
<li>:init-mode -&gt; <code>:line</code></li>
</ul></li>
<li>:autostart? <code>true</code>
<ul class="org-ul">
<li>to ensure that the switcher behaviour starts when it's added to the canvas</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-orge7dd54d" class="outline-2">
<h2 id="orge7dd54d"><span class="section-number-2">20.</span> Add switcher to canvas</h2>
<div class="outline-text-2" id="text-20">
<p>
<a href="#org563fa73">Top</a>
</p>
<ul class="org-ul">
<li><b>Goto</b> &gt; <code>:render &gt; canvas</code></li>
<li>Deselect all behaviours</li>
<li>Select <code>switcher</code></li>
<li><code>[close</code> (:#behaviours) <code>]</code> as now done</li>
</ul>
</div>
</div>
<div id="outline-container-orgba0cbee" class="outline-2">
<h2 id="orgba0cbee"><span class="section-number-2">21.</span> <b>Preview Component</b></h2>
<div class="outline-text-2" id="text-21">
<p>
<a href="#org563fa73">Top</a>
</p>
<ul class="org-ul">
<li>We can still draw a line on the canvas;</li>
<li><code>scroll-to</code> :behaviours &gt; switcher</li>
<li>If we go back up to switcher behaviour,
<ul class="org-ul">
<li>and set the :init-mode to <code>:rectangle</code>,</li>
</ul></li>
<li><b>Preview Component</b>
<ul class="org-ul">
<li>we can now draw rectangles on the canvas;</li>
</ul></li>
<li>Which means our switcher behaviour,
<ul class="org-ul">
<li>which is the only behaviour which is active on the canvas,</li>
<li>is working correctly;</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org0126cc2" class="outline-2">
<h2 id="org0126cc2"><span class="section-number-2">22.</span> Add canvas mode buttons</h2>
<div class="outline-text-2" id="text-22">
<p>
<a href="#org563fa73">Top</a>
</p>
<ul class="org-ul">
<li>So now we need a way for our users to switch the behaviour themselves;</li>
<li>For that, we'll create a set of buttons in the panel on the left hand side,
<ul class="org-ul">
<li>one for each mode;</li>
</ul></li>
<li><b>Goto</b> &gt; <code>:behaviours &gt; switcher</code></li>
<li>Our <code>switcher</code> behaviour has a <code>:mode-state</code> key which is set to the <code>canvas-mode</code> state variable;
<ul class="org-ul">
<li>so we need to be able to update the <code>canvas-mode</code> state variable to change the active behaviour on the canvas;</li>
</ul></li>
<li>To do that, we'll create a set of buttons.</li>
</ul>
</div>
</div>
<div id="outline-container-org56c3494" class="outline-2">
<h2 id="org56c3494"><span class="section-number-2">23.</span> Add :#each Special Element</h2>
<div class="outline-text-2" id="text-23">
<p>
<a href="#org563fa73">Top</a>
</p>
<ul class="org-ul">
<li><b>Goto</b> &gt; <code>:render</code></li>
<li><code>[open</code> <b>div.control-panel</b> <code>for editing]</code></li>
</ul>
</div>
<div id="outline-container-orgf351b3e" class="outline-3">
<h3 id="orgf351b3e"><span class="section-number-3">23.1.</span> Add :fieldset</h3>
<div class="outline-text-3" id="text-23-1">
<p>
<a href="#org563fa73">Top</a>
</p>
<ul class="org-ul">
<li>First we'll create a panel for the buttons;</li>
<li><code>click on</code> <b>Add &gt; :fieldset</b></li>
</ul>
<div class="org-src-container">
<pre class="src src-clojurescript"><span style="color: #707183;">[</span><span style="color: #F5666D;">:fieldset</span>
 <span style="color: #7388d6;">[</span><span style="color: #F5666D;">:legend</span> <span style="color: #4E9A06;">"Canvas Mode"</span><span style="color: #7388d6;">]</span><span style="color: #707183;">]</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orge22a64b" class="outline-3">
<h3 id="orge22a64b"><span class="section-number-3">23.2.</span> Add :div with :on-click Event Map</h3>
<div class="outline-text-3" id="text-23-2">
<p>
<a href="#org563fa73">Top</a>
</p>
<ul class="org-ul">
<li><code>Within ~:fieldset~, under ~:legend~</code></li>
<li>Next we'll create a :div element with an event handler to capture all button click events;
<ul class="org-ul">
<li><code>click on</code> <b>Add &gt; :div</b></li>
</ul></li>
</ul>
<div class="org-src-container">
<pre class="src src-clojurescript"><span style="color: #707183;">[</span><span style="color: #F5666D;">:div</span>
  <span style="color: #7388d6;">{</span><span style="color: #F5666D;">:on-click</span>
   <span style="color: #909183;">{</span><span style="color: #F5666D;">:handler</span> <span style="color: #F5666D;">:reset</span>
    <span style="color: #F5666D;">:arg</span>     <span style="color: #709870;">{</span><span style="color: #F5666D;">:state</span> canvas-mode
              <span style="color: #F5666D;">:value</span> <span style="color: #F5666D;">nil</span><span style="color: #709870;">}</span><span style="color: #909183;">}</span><span style="color: #7388d6;">}</span><span style="color: #707183;">]</span>
</pre>
</div>
<ul class="org-ul">
<li>We'll leave the :value empty, so that each button can supply its own value;</li>
</ul>
</div>
</div>
<div id="outline-container-orgfd75181" class="outline-3">
<h3 id="orgfd75181"><span class="section-number-3">23.3.</span> Add Buttons</h3>
<div class="outline-text-3" id="text-23-3">
<p>
<a href="#org563fa73">Top</a>
</p>
<ul class="org-ul">
<li><code>Within :div</code></li>
<li>Now let's add the buttons to let our users change mode;</li>
<li><code>click on</code> <b>Add &gt; Add Input &gt; Button</b></li>
<li>which creates an input button element;
<ul class="org-ul">
<li>:value - "Line"</li>
<li>DELETE :on-click</li>
<li>add: <code>:data-value</code> instead,
<ul class="org-ul">
<li>and set its value to :line,</li>
<li>which is the key taken from the :behaviours map of the :switcher behaviour</li>
</ul></li>
</ul></li>
<li><code>Copy + Paste Child</code>
<ul class="org-ul">
<li>"Rectangle" :rectangle,</li>
<li>"Fill Circle" :fill-circle;</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org07b15c1" class="outline-3">
<h3 id="org07b15c1"><span class="section-number-3">23.4.</span> Update parent :div Event Handler</h3>
<div class="outline-text-3" id="text-23-4">
<p>
<a href="#org563fa73">Top</a>
</p>
<ul class="org-ul">
<li>When a user presses a button, it needs to change the active mode on the Canvas;</li>
<li><code>scroll-to</code> parent :div Event Map</li>
<li>We've added an event handler in the parent :div which will will set the <code>canvas-mode</code> state variable whenever a user clicks on a button;</li>
<li>This works using Event Delegation, so we need to tell our Event Map to extract the <code>:data-value</code> attribute from the button which is pressed;</li>
<li>To do that, we need to add an :arg-spec to the Event Map</li>
<li><code>click on</code> <b>Add &gt; :arg-spec</b>
<ul class="org-ul">
<li><code>click on</code> <b>Add &gt; :data-args</b> to extract data from one or more data- attributes of the button;
<ul class="org-ul">
<li>Within the Attribute Coercer editor, I need to supply any data-attribute names I'm interested in, without the "data-" prefix;</li>
<li><code>:data-value</code> without the data- prefix is <code>:value</code></li>
<li>For its value, I'll select <code>:Keyword</code></li>
</ul></li>
</ul></li>
<li><code>[close</code> (Parent Event Map | Attributes Map) <code>]</code></li>
<li>What the :arg-spec is saying is:
<ul class="org-ul">
<li>"Take the value of the :data-value attribute of the button which the user presses,</li>
<li>which is a string,</li>
<li>then coerce it into a Keyword,</li>
<li>and pass the result to the :reset event handler in the :arg map as the :value key;</li>
</ul></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org3e25558" class="outline-2">
<h2 id="org3e25558"><span class="section-number-2">24.</span> <b>Preview Component</b></h2>
<div class="outline-text-2" id="text-24">
<p>
<a href="#org563fa73">Top</a>
</p>
<ul class="org-ul">
<li>First, we have a "Canvas Mode" section in the left panel,
<ul class="org-ul">
<li>with three buttons</li>
<li>one for each mode</li>
</ul></li>
<li>[Demo]</li>
<li>So our users can finally select what to draw on the canvas,
<ul class="org-ul">
<li>which is an improvement;</li>
</ul></li>
<li>However, as it stands, they can only draw black shapes,
<ul class="org-ul">
<li>with very thin lines;</li>
</ul></li>
<li>Let's give them the ability to change both color and line thickness;</li>
</ul>
</div>
</div>
<div id="outline-container-org71cba32" class="outline-2">
<h2 id="org71cba32"><span class="section-number-2">25.</span> Set canvas-styles state var</h2>
<div class="outline-text-2" id="text-25">
<p>
<a href="#org563fa73">Top</a>
</p>
<ul class="org-ul">
<li><b>Goto</b> &gt; <code>Code &gt; :behaviours</code></li>
<li>Our line, rectangle, and circle behaviours all have their :canvas-styles argument set to the <code>canvas-styles</code> state variable</li>
<li><code>scroll-to</code> :state
<ul class="org-ul">
<li>which until now we've kept as an empty map;</li>
</ul></li>
<li><code>[open</code> <b>canvas-styles map</b> <code>for editing]</code></li>
<li>Let's now update this map, as follows;</li>
</ul>
<div class="org-src-container">
<pre class="src src-clojurescript"><span style="color: #707183;">{</span><span style="color: #4E9A06;">"fillStyle"</span>   <span style="color: #4E9A06;">"Browser Color &gt; orange"</span>
 <span style="color: #4E9A06;">"strokeStyle"</span> <span style="color: #4E9A06;">"Browser Color &gt; blue"</span>
 <span style="color: #4E9A06;">"lineWidth"</span>   <span style="color: #4E9A06;">"Number &gt; 5"</span>
 <span style="color: #707183;">}</span>
</pre>
</div>
<ul class="org-ul">
<li>I know these properties off the top of my head,
<ul class="org-ul">
<li>and they're taken from the Canvas Context object;</li>
</ul></li>
<li>Eventually there'll be an editor which lets you select these values so you don't have to remember them;</li>
</ul>
</div>
</div>
<div id="outline-container-orgce562dc" class="outline-2">
<h2 id="orgce562dc"><span class="section-number-2">26.</span> <b>Preview Component</b></h2>
<div class="outline-text-2" id="text-26">
<p>
<a href="#org563fa73">Top</a>
</p>
<ul class="org-ul">
<li>Draw Circle - nice orange color</li>
<li>Draw Line</li>
<li>Draw Rectangle</li>
<li>both are blue, with a thickness of 5 pixels</li>
<li>So this shows that to set styles for each shape we draw,
<ul class="org-ul">
<li>all we had to was to update the canvas-styles state variable</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-orgada8376" class="outline-2">
<h2 id="orgada8376"><span class="section-number-2">27.</span> Add table to update canvas-styles</h2>
<div class="outline-text-2" id="text-27">
<p>
<a href="#org563fa73">Top</a>
</p>
<ul class="org-ul">
<li>Now all we need to do is to give our users the same ability to be able to update these styles;</li>
<li>To do that, let's create a table of controls;</li>
<li><b>Goto</b> &gt; <code>:render &gt; div.control-panel</code></li>
</ul>
<div class="org-src-container">
<pre class="src src-clojurescript"><span style="color: #707183;">[</span><span style="color: #F5666D;">:fieldset</span>
 <span style="color: #7388d6;">[</span><span style="color: #F5666D;">:legend</span> <span style="color: #4E9A06;">"Styles"</span><span style="color: #7388d6;">]</span><span style="color: #707183;">]</span>
</pre>
</div>
<ul class="org-ul">
<li>and within the :fieldset, let's create a <code>table</code> element;</li>
</ul>
<div class="org-src-container">
<pre class="src src-clojurescript"><span style="color: #707183;">[</span><span style="color: #F5666D;">:table</span>
 <span style="color: #204A87;">;; </span><span style="color: #204A87;">DELETE</span>
 <span style="color: #7388d6;">[</span><span style="color: #F5666D;">:thead</span> ...<span style="color: #7388d6;">]</span>

 <span style="color: #7388d6;">[</span><span style="color: #F5666D;">:tbody</span>
  <span style="color: #204A87;">;; </span><span style="color: #204A87;">Create</span>
  <span style="color: #909183;">[</span><span style="color: #F5666D;">:tr</span>
   <span style="color: #709870;">[</span><span style="color: #F5666D;">:td</span> <span style="color: #4E9A06;">"Fill Color"</span><span style="color: #709870;">]</span>
   <span style="color: #709870;">[</span><span style="color: #F5666D;">:td</span>
    <span style="color: #204A87;">;; </span><span style="color: #204A87;">:value @Reactive &gt; ???</span>
    <span style="color: #204A87;">;; </span><span style="color: #204A87;">We'll come back to this</span>
    <span style="color: #907373;">[</span><span style="color: #F5666D;">:</span><span style="color: #2F8B58; font-weight: bold;">input</span><span style="color: #2E3436; background-color: #EDEDED;">/</span><span style="color: #F5666D;">color</span> <span style="color: #6276ba;">{</span><span style="color: #F5666D;">:value</span> <span style="color: #F5666D;">:???</span><span style="color: #6276ba;">}</span><span style="color: #907373;">]</span><span style="color: #709870;">]</span><span style="color: #909183;">]</span>
  <span style="color: #204A87;">;; </span><span style="color: #204A87;">Copy :tr and paste</span>
  <span style="color: #909183;">[</span><span style="color: #F5666D;">:tr</span>
   <span style="color: #709870;">[</span><span style="color: #F5666D;">:td</span> <span style="color: #4E9A06;">"Stroke Color"</span><span style="color: #709870;">]</span>
   <span style="color: #709870;">[</span><span style="color: #F5666D;">:td</span> <span style="color: #907373;">[</span><span style="color: #F5666D;">:</span><span style="color: #2F8B58; font-weight: bold;">input</span><span style="color: #2E3436; background-color: #EDEDED;">/</span><span style="color: #F5666D;">color</span> <span style="color: #6276ba;">{</span><span style="color: #F5666D;">:value</span> <span style="color: #F5666D;">:???</span><span style="color: #6276ba;">}</span><span style="color: #907373;">]</span><span style="color: #709870;">]</span><span style="color: #909183;">]</span>
  <span style="color: #909183;">[</span><span style="color: #F5666D;">:tr</span>
   <span style="color: #204A87;">;; </span><span style="color: #204A87;">Copy :tr and paste</span>
   <span style="color: #709870;">[</span><span style="color: #F5666D;">:td</span> <span style="color: #4E9A06;">"Line Width"</span><span style="color: #709870;">]</span>
   <span style="color: #709870;">[</span><span style="color: #F5666D;">:td</span>
    <span style="color: #907373;">[</span><span style="color: #F5666D;">:</span><span style="color: #2F8B58; font-weight: bold;">input</span><span style="color: #2E3436; background-color: #EDEDED;">/</span><span style="color: #F5666D;">number</span> <span style="color: #6276ba;">{</span><span style="color: #F5666D;">:value</span> <span style="color: #F5666D;">:???</span>
                    <span style="color: #F5666D;">:min</span>   0
                    <span style="color: #F5666D;">:max</span>   50
                    <span style="color: #F5666D;">:step</span>  0.1<span style="color: #6276ba;">}</span><span style="color: #907373;">]</span>
    <span style="color: #907373;">[</span><span style="color: #F5666D;">:</span><span style="color: #2F8B58; font-weight: bold;">input</span><span style="color: #2E3436; background-color: #EDEDED;">/</span><span style="color: #F5666D;">range</span> <span style="color: #6276ba;">{</span><span style="color: #F5666D;">:value</span> <span style="color: #F5666D;">:???</span>
                   <span style="color: #F5666D;">:min</span>   0
                   <span style="color: #F5666D;">:max</span>   50
                   <span style="color: #F5666D;">:step</span>  0.1<span style="color: #6276ba;">}</span><span style="color: #907373;">]</span><span style="color: #709870;">]</span><span style="color: #909183;">]</span><span style="color: #7388d6;">]</span><span style="color: #707183;">]</span>
</pre>
</div>
<ul class="org-ul">
<li>So for all three rows we've just added,
<ul class="org-ul">
<li>we need to connect each input element's :value attribute to a state variable,</li>
<li>so that the input element can control that state variable;</li>
</ul></li>
<li>We have the <code>canvas-styles</code> state variable,
<ul class="org-ul">
<li>but we can't set that directly;</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-orgf8b9e5d" class="outline-2">
<h2 id="orgf8b9e5d"><span class="section-number-2">28.</span> Destructure canvas-styles state variable</h2>
<div class="outline-text-2" id="text-28">
<p>
<a href="#org563fa73">Top</a>
</p>
<ul class="org-ul">
<li><b>Goto</b> &gt; <code>:state</code></li>
<li><code>canvas-styles</code> is a map of three items;</li>
<li>And we need to pass a state variable to each input element's :value attribute so the input element can control that part of <code>canvas-styles</code></li>
<li>The way to do this is to use <i>map destructuring</i>;</li>
<li><code>click on</code> <b>canvas-styles &gt; Destructure</b></li>
<li>The keys in the <code>canvas-styles</code> map are string keys, so we need to use:</li>
<li>{{{click({:strs [&#x2026;]}}}</li>
</ul>
<div class="org-src-container">
<pre class="src src-clojurescript"><span style="color: #707183;">{</span><span style="color: #F5666D;">:strs</span> <span style="color: #7388d6;">[</span>fillStyle
        strokeStyle
        lineWidth<span style="color: #7388d6;">]</span><span style="color: #707183;">}</span>
</pre>
</div>
<ul class="org-ul">
<li><code>[close</code> (canvas-styles) <code>]</code></li>
<li>What we've just done is to introduce three new state variables,
<ul class="org-ul">
<li>but they aren't really state variables;</li>
<li>they're all part of the <code>canvas-styles</code> state variable,</li>
<li>and the technical name for them is <i>cursors</i>;</li>
</ul></li>
<li>The great thing about these cursors is that we can now use them within the :input elements we created,
<ul class="org-ul">
<li>to control each individual style within <code>canvas-styles</code></li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-orgc2df9f5" class="outline-2">
<h2 id="orgc2df9f5"><span class="section-number-2">29.</span> Add cursors to :input elements</h2>
<div class="outline-text-2" id="text-29">
<p>
<a href="#org563fa73">Top</a>
</p>
<ul class="org-ul">
<li><code>click on</code> <b>Browser Back</b></li>
<li><code>set :value of each row accordingly</code></li>
</ul>
</div>
</div>
<div id="outline-container-org76fa7c9" class="outline-2">
<h2 id="org76fa7c9"><span class="section-number-2">30.</span> <b>Preview Component</b></h2>
<div class="outline-text-2" id="text-30">
<p>
<a href="#org563fa73">Top</a>
</p>
<ul class="org-ul">
<li>Now we have a new section of controls,
<ul class="org-ul">
<li>which let us set the styles in our <code>canvas-styles</code></li>
</ul></li>
<li><code>Demo</code>
<ul class="org-ul">
<li>Draw Line &gt; change width &gt; draw again</li>
<li>Draw Rect &gt; change stroke color &gt; draw again</li>
<li>Draw Circle &gt; change fill color &gt; draw again</li>
</ul></li>
<li>This is now looking much better;
<ul class="org-ul">
<li>our users can draw different shapes,</li>
<li>and they can set styles for those shapes;</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org57ac611" class="outline-2">
<h2 id="org57ac611"><span class="section-number-2">31.</span> Last steps: Clear Canvas, Download</h2>
<div class="outline-text-2" id="text-31">
<p>
<a href="#org563fa73">Top</a>
</p>
<ul class="org-ul">
<li>We could keep adding more canvas shape behaviours,
<ul class="org-ul">
<li>and more buttons to allow our users to select those;</li>
</ul></li>
<li>But I want to add two other features instead;</li>
<li>First, let's give our users the ability to clear the canvas</li>
</ul>
<div class="org-src-container">
<pre class="src src-clojurescript"><span style="color: #707183;">[</span><span style="color: #F5666D;">:fieldset</span>
 <span style="color: #7388d6;">[</span><span style="color: #F5666D;">:legend</span> <span style="color: #4E9A06;">"Utilities"</span>
  <span style="color: #909183;">[</span><span style="color: #F5666D;">:</span><span style="color: #2F8B58; font-weight: bold;">input</span><span style="color: #2E3436; background-color: #EDEDED;">/</span><span style="color: #F5666D;">button</span>
   <span style="color: #709870;">{</span><span style="color: #F5666D;">:value</span>    <span style="color: #4E9A06;">"Clear"</span>
    <span style="color: #F5666D;">:on-click</span> <span style="color: #907373;">{</span><span style="color: #F5666D;">:handler</span> <span style="color: #F5666D;">:</span><span style="color: #2F8B58; font-weight: bold;">html.canvas</span><span style="color: #2E3436; background-color: #EDEDED;">/</span><span style="color: #F5666D;">clear</span>
               <span style="color: #F5666D;">:arg</span>     <span style="color: #6276ba;">{</span><span style="color: #F5666D;">:canvas-id</span> <span style="color: #F5666D;">:???</span><span style="color: #6276ba;">}</span><span style="color: #907373;">}</span><span style="color: #709870;">}</span><span style="color: #909183;">]</span><span style="color: #7388d6;">]</span><span style="color: #707183;">]</span>
</pre>
</div>
<ul class="org-ul">
<li>We need to set a canvas id and pass that to the handler;</li>
<li><code>scroll-to</code> canvas</li>
<li><code>[open</code> <b>Attributes</b> <code>for editing]</code></li>
<li>Traditionally, to add an id to an element, we would use the HTML Element <code>:id</code> attribute;
<ul class="org-ul">
<li><code>click on</code> <b>Add</b></li>
<li>:id "my-canvas"</li>
</ul></li>
<li>However, the problem with this approach is that if we had two instances of this component on the same page, then the canvas element in each component would have the same id, and so only one of them would be referenced;</li>
<li>To get around this problem, Entmorph has a special :#id attribute which creates a unique id for that element;</li>
<li><code>click on</code> <b>Add Special</b>
<ul class="org-ul">
<li><code>:#id</code> my-canvas</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-orgbcb6993" class="outline-2">
<h2 id="orgbcb6993"><span class="section-number-2">32.</span> Set :html.canvas/clear :canvas-id</h2>
<div class="outline-text-2" id="text-32">
<p>
<a href="#org563fa73">Top</a>
</p>
<ul class="org-ul">
<li>Now let's go back to our Clear button</li>
<li>We need to set the :canvas-id for the Event Map in the Clear button;</li>
<li>So if I click on its value, I can actually just search for the <code>my-canvas</code> id, and it appears in the dropdown,
<ul class="org-ul">
<li>so I'll select it to set the <code>:canvas-id</code> value;</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org05cf2a2" class="outline-2">
<h2 id="org05cf2a2"><span class="section-number-2">33.</span> Add Download button</h2>
<div class="outline-text-2" id="text-33">
<p>
<a href="#org563fa73">Top</a>
</p>
<div class="org-src-container">
<pre class="src src-clojurescript"><span style="color: #707183;">[</span><span style="color: #F5666D;">:</span><span style="color: #2F8B58; font-weight: bold;">input</span><span style="color: #2E3436; background-color: #EDEDED;">/</span><span style="color: #F5666D;">button</span>
 <span style="color: #7388d6;">{</span><span style="color: #F5666D;">:value</span>    <span style="color: #4E9A06;">"Download"</span>
  <span style="color: #F5666D;">:on-click</span> <span style="color: #909183;">{</span><span style="color: #F5666D;">:handler</span> <span style="color: #F5666D;">:</span><span style="color: #2F8B58; font-weight: bold;">html.canvas</span><span style="color: #2E3436; background-color: #EDEDED;">/</span><span style="color: #F5666D;">download</span>
             <span style="color: #F5666D;">:arg</span>     <span style="color: #709870;">{</span><span style="color: #F5666D;">:canvas-id</span> my-canvas<span style="color: #709870;">}</span><span style="color: #909183;">}</span><span style="color: #7388d6;">}</span><span style="color: #707183;">]</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgda8ee6e" class="outline-2">
<h2 id="orgda8ee6e"><span class="section-number-2">34.</span> <b>Preview Component</b></h2>
<div class="outline-text-2" id="text-34">
<p>
<a href="#org563fa73">Top</a>
</p>
<ul class="org-ul">
<li>Now we have a "Utilities" panel in our control panel on the LHS</li>
<li><code>Draw shapes</code></li>
<li><code>click on</code> <b>Download</b>
<ul class="org-ul">
<li>Works</li>
</ul></li>
<li><code>Draw shapes</code></li>
<li><code>click on</code> <b>Clear</b>
<ul class="org-ul">
<li>Works</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org89d0bea" class="outline-2">
<h2 id="org89d0bea"><span class="section-number-2">35.</span> <span class="todo TODO">TODO</span> :noexport:</h2>
<div class="outline-text-2" id="text-35">
<p>
<a href="#org563fa73">Top</a>
</p>
<ul class="org-ul">
<li>Capture mouse events outside of the canvas using new functionality</li>
</ul>
</div>
</div>
<div id="outline-container-orgb0c4f8b" class="outline-2">
<h2 id="orgb0c4f8b"><span class="section-number-2">36.</span> Conclusion</h2>
<div class="outline-text-2" id="text-36">
<p>
<a href="#org563fa73">Top</a>
</p>
<ul class="org-ul">
<li>Throughout this video, I've used tools which have always been available to our users as part of the development process;
<ul class="org-ul">
<li>this is one of the goals of Entmorph, to give developers access to as many tools as possible to make their jobs much easier, quicker, and less error prone;</li>
</ul></li>
<li>To create this component from scratch,
<ul class="org-ul">
<li>it takes around 5 minutes when I'm not explaining how to create it;</li>
<li>and another couple of minutes to create the styles for it using the component styles editor;</li>
</ul></li>
<li>To do the same thing in HTML, JavaScript and CSS will easily take several hours and would require a lot more code;</li>
<li>Just to be able to draw on the canvas requires a detailed knowledge of how the Canvas API works,
<ul class="org-ul">
<li>as well as a lot of event handling code which for this particular case is a huge pain to write;</li>
</ul></li>
<li>In the Entmorph version, all we really had to do was to create:
<ul class="org-ul">
<li>two state variables,</li>
<li>four behaviours</li>
<li>and a set of HTML elements including
<ul class="org-ul">
<li>which are connected to the behaviours and the state variables as required;</li>
</ul></li>
</ul></li>
<li>The Entmorph version is almost entirely declarative,
<ul class="org-ul">
<li>and requires a tiny amount of code to produce a lot of functionality;</li>
</ul></li>
<li>There are more features like Undo and Redo which I'll cover in a future video;</li>
<li>I hope you enjoyed this video,
<ul class="org-ul">
<li>stay tuned for more,</li>
<li>and thanks for watching.</li>
</ul></li>
</ul>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Created: 2025-06-29 Sun 22:53</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
